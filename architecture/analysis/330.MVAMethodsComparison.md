# 330 - MVA Methods Comparison

Purpose
- Document the design and integration of the "Analysis Methods Comparison" feature in the Analysis editor.

Overview
- Provides a UI section that renders available analysis methods as selectable cards so users can compare results produced by different methods.
- Cards are sourced from metadata endpoints and include an Info modal populated from metadata.
- The selected analysis method (in the main Analysis Method combobox) is shown above the cards and its corresponding card is disabled to avoid comparing a method with itself.
- Selected comparison methods are saved under the configuration key `analysis_methods_comparison`.

Files touched
- Template: [app/templates/dataset/analysis_config.html](app/templates/dataset/analysis_config.html) — adds the card container and the selected-method display.
- Client (analysis manager): [app/static/js/dataset_analysis.js](app/static/js/dataset_analysis.js) — renderer for comparison cards and helper to disable matching card.
- Client (page-level): [app/static/js/dataset.js](app/static/js/dataset.js) — triggers `updateAnalysisMethodsVisibility()` when the main analysis method selection changes.
- Metadata: [metadata/ANALYSIS_METHODS.py](metadata/ANALYSIS_METHODS.py) — source of method descriptions, parameters, pros/cons/use-cases; includes a helper to return UI-friendly entries.

Client behavior and functions
- Data fetch
  - Endpoint: `/dataset/<id>/metadata/analysis-methods` returns the available methods (object or array). The client normalizes to an array.
  - Per-method details: `/dataset/<id>/metadata/analysis-methods/<methodKey>` is used by the Analysis Method selector to load parameters.

- Main functions (client side)
  - `DatasetAnalysisManager.displayAnalysisMethodsComparison(methods)`
    - Renders the two-column grid of method cards inside `#analysisMethodsContainer`.
    - Each card contains a checkbox, short description, and an `Info` button.
  - `DatasetAnalysisManager.updateAnalysisMethodsVisibility()`
    - Reads the selected analysis method from `#analysisMethodSelect` and updates `#selectedAnalysisMethodDisplay` with the option's visible text.
    - Disables and unchecks the comparison checkbox that matches the selected main method; re-enables others.
  - `showAnalysisMethodInfo(methodKey)` and `getAnalysisMethodInfo(methodKey)`
    - Build and show the Info modal using metadata fields: title, description, parameters (name/default/description), pros, cons, limitations, expectations.
  - Selection helpers: `selectAllAnalysisMethods()`, `clearAllAnalysisMethods()`, summary updater `updateAnalysisMethodsSummary()`.
  - Persistence: `collectAnalysisMethodsComparison()` returns array of selected method keys; saved into analysis configuration as `analysis_methods_comparison`.

UI details
- Layout: a short single-line text above the cards: "MVA Method selected in Analysis: <strong>Method Name</strong>" — this display now spans the full row.
- Cards: rendered in a responsive two-column grid (`grid-template-columns: repeat(2, 1fr)`) to keep visual parity with other comparison sections.
- Header controls: Show/Hide toggle (which toggles the container's `display`), `Select All`, and `Clear All` buttons.
- Info modal: reuse of existing policy/info modal pattern; shows description, algorithm placeholder, parameters list, pros/cons, limitations, expected results.

Notes & edge cases
- The analysis-methods metadata endpoint may return either an object keyed by method or an array — the client normalizes both forms into an array with consistent fields (`key`, `title`, `description`, `info`).
- Authentication: metadata endpoints are protected by the app; testing requires an authenticated browser session.
- If a method has no `info.parameters` but has `parameters`, the Info modal will map those parameter definitions into the modal presentation.

Testing checklist
- Open Analysis editor while logged in and verify:
  - `#selectedAnalysisMethodDisplay` shows the currently selected analysis method's visible label.
  - The comparison grid (`#analysisMethodsContainer`) populates with method cards.
  - The card matching the selected main method is disabled and unchecked.
  - `Select All` respects disabled cards and doesn't check them.
  - `Info` opens a modal with populated pros/cons/parameters.
  - Saving the analysis stores selected method keys under `analysis_methods_comparison`.

Change history
- 2026-01-18: Initial implementation and documentation created.

Summary
- The feature renders comparison cards from metadata, presents method info via modal, disables the currently-selected analysis method's comparison card, and persists chosen comparisons in the analysis configuration.
