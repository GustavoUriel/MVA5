<!-- Analysis Editor Section -->
<div class="row" id="analysisEditorSection" style="display: none">
  <div class="col-12">
    <div class="card border-primary">
      <div class="card-header bg-primary text-white">
        <div class="d-flex align-items-center justify-content-between">
          <h6 class="mb-0">
            <i class="fas fa-edit me-2"></i>
            <span id="editorTitle">Analysis Configuration</span>
          </h6>
          <div class="btn-group">
            <button type="button" class="btn btn-light btn-sm" onclick="saveAnalysis()">
              <i class="fas fa-save me-1"></i>Save
            </button>
            <button type="button" class="btn btn-outline-light btn-sm" onclick="cancelAnalysisEdit()">
              <i class="fas fa-times me-1"></i>Close
            </button>
          </div>
        </div>
      </div>
      <div class="card-body">
        <!-- Analysis Information Section -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card border-info">
              <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                  <i class="fas fa-info-circle me-2"></i>
                  Analysis Information
                </h6>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <label for="analysisName" class="form-label">Analysis Name</label>
                    <input type="text" class="form-control" id="analysisName" name="analysisName" placeholder="Enter analysis name..." />
                  </div>
                  <div class="col-md-6">
                    <label for="analysisDescription" class="form-label">Description</label>
                    <input
                      type="text"
                      class="form-control"
                      id="analysisDescription"
                      name="analysisDescription"
                      placeholder="Brief description..." />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Editor Tabs -->
        <ul class="nav nav-tabs" id="analysisEditorTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="datasources-editor-tab"
              data-bs-toggle="tab"
              data-bs-target="#datasources-editor"
              type="button"
              role="tab">
              <i class="fas fa-layer-group me-2"></i>Data Sources
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="preanalysis-editor-tab"
              data-bs-toggle="tab"
              data-bs-target="#preanalysis-editor"
              type="button"
              role="tab">
              <i class="fas fa-filter me-2"></i>Pre-Analysis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="analysis-editor-tab"
              data-bs-toggle="tab"
              data-bs-target="#analysis-editor"
              type="button"
              role="tab">
              <i class="fas fa-flask me-2"></i>Analysis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="postanalysis-editor-tab"
              data-bs-toggle="tab"
              data-bs-target="#postanalysis-editor"
              type="button"
              role="tab">
              <i class="fas fa-chart-bar me-2"></i>Post-Analysis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="output-editor-tab"
              data-bs-toggle="tab"
              data-bs-target="#output-editor"
              type="button"
              role="tab">
              <i class="fas fa-file-export me-2"></i>Output Options
            </button>
          </li>
        </ul>

        <div class="tab-content mt-3" id="analysisEditorTabsContent">
          <!-- Data Sources Editor Tab -->
          <div class="tab-pane fade show active" id="datasources-editor" role="tabpanel">
            <!-- File Selection Section -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fas fa-files me-2"></i>
                      Data Files Selection
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <!-- Patient File Selection -->
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="editorPatientFileSelect" class="form-label">
                            <i class="fas fa-user-injured text-primary me-2"></i>
                            Patient Data File
                          </label>
                          <select class="form-select" id="editorPatientFileSelect" name="editorPatientFileSelect" onchange="validateAnalysisEditor()">
                            <option value="">Select patient file...</option>
                            <!-- Options will be populated dynamically -->
                          </select>
                          <div class="form-text">Choose the patient metadata file for analysis</div>
                        </div>
                      </div>

                      <!-- Taxonomy File Selection -->
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="editorTaxonomyFileSelect" class="form-label">
                            <i class="fas fa-sitemap text-info me-2"></i>
                            Taxonomy Data File
                          </label>
                          <select class="form-select" id="editorTaxonomyFileSelect" name="editorTaxonomyFileSelect" onchange="validateAnalysisEditor()">
                            <option value="">Select taxonomy file...</option>
                            <!-- Options will be populated dynamically -->
                          </select>
                          <div class="form-text">Choose the taxonomy reference file</div>
                        </div>
                      </div>

                      <!-- Bracken File Selection -->
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="editorBrackenFileSelect" class="form-label">
                            <i class="fas fa-chart-bar text-success me-2"></i>
                            Bracken Results File
                          </label>
                          <select class="form-select" id="editorBrackenFileSelect" name="editorBrackenFileSelect" onchange="validateAnalysisEditor()">
                            <option value="">Select bracken file...</option>
                            <!-- Options will be populated dynamically -->
                          </select>
                          <div class="form-text">Choose the bracken abundance data file</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Bracken Time Point Selection -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fas fa-clock text-primary me-2"></i>
                      Bracken Time Point Selection
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="editorBrackenTimePointSelect" class="form-label">
                            <i class="fas fa-calendar-alt text-warning me-2"></i>
                            Time Point Selection
                          </label>
                          <select class="form-select" id="editorBrackenTimePointSelect" name="editorBrackenTimePointSelect" onchange="updateTimePointDescription()">
                            <!-- Options will be populated dynamically -->
                          </select>
                          <div class="form-text">Choose the time point from your Bracken data for analysis</div>
                        </div>
                      </div>
                      <div class="col-md-8">
                        <label class="form-label">Time Point Description</label>
                        <div class="d-flex align-items-center">
                          <span id="timePointDescriptionText">Select a time point to see its description</span>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <!-- Extreme Time Point Selection -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fas fa-chart-line me-2"></i>
                      Extreme Time Point Selection
                    </h6>
                  </div>
                  <div class="card-body">
                    <!-- Selection Mode Toggle -->
                    <div class="row mb-3">
                      <div class="col-12">
                        <div class="form-check form-switch">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="selectionModeToggle"
                            name="selectionModeToggle"
                            onchange="toggleSelectionMode()" />
                          <label class="form-check-label" for="selectionModeToggle">
                            <i class="fas fa-toggle-on me-2"></i>
                            <span id="selectionModeLabel">Select by percentage of patients</span>
                          </label>
                        </div>
                        <div class="form-text" id="selectionModeDescription">
                          When enabled: Select by percentage of time variable value range. When disabled: Select by
                          percentage of patients.
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="topPercentage" class="form-label">
                            <i class="fas fa-arrow-up text-success me-2"></i>
                            <span id="topPercentageLabel">Top Percentage</span>
                          </label>
                          <div class="input-group">
                            <input
                              type="range"
                              class="form-range"
                              id="topPercentage"
                              name="topPercentage"
                              min="10"
                              max="50"
                              value="25"
                              step="5"
                              oninput="updateTopPercentage(this.value)" />
                            <span class="input-group-text" id="topPercentageValue">25%</span>
                          </div>
                          <div class="form-text" id="topPercentageDescription">
                            Percentage of patients with highest time values
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="bottomPercentage" class="form-label">
                            <i class="fas fa-arrow-down text-danger me-2"></i>
                            <span id="bottomPercentageLabel">Bottom Percentage</span>
                          </label>
                          <div class="input-group">
                            <input
                              type="range"
                              class="form-range"
                              id="bottomPercentage"
                              name="bottomPercentage"
                              min="10"
                              max="50"
                              value="25"
                              step="5"
                              oninput="updateBottomPercentage(this.value)" />
                            <span class="input-group-text" id="bottomPercentageValue">25%</span>
                          </div>
                          <div class="form-text" id="bottomPercentageDescription">
                            Percentage of patients with lowest time values
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="linkPercentages"
                            name="linkPercentages"
                            checked
                            onchange="toggleLinkedPercentages()" />
                          <label class="form-check-label" for="linkPercentages">
                            <i class="fas fa-link me-2"></i>
                            Link top and bottom percentages to the same value
                          </label>
                        </div>
                      </div>
                    </div>

                    <!-- Extreme Time Point Summary -->
                    <div class="mt-3 p-3 bg-light rounded">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="extremeTimePointSummaryText">Select data files to see patient counts</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <span class="badge bg-success me-2" id="topPatientsCount">0 patients</span>
                          <span class="badge bg-danger me-2" id="bottomPatientsCount">0 patients</span>
                          <span class="badge bg-primary" id="totalPatientsCount">0 total</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Attributes Groups Selection -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-layer-group me-2"></i>
                        Attributes Groups Selection
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleColumnGroupsBtn"
                          onclick="toggleColumnGroups()">
                          <i class="fas fa-eye me-1"></i>Show Groups
                        </button>
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleFieldNamesBtn"
                          onclick="toggleFieldNames()">
                          <i class="fas fa-eye me-1"></i>Show Field Names
                        </button>
                        <button type="button" class="btn btn-outline-primary" onclick="selectAllColumnGroups()">
                          <i class="fas fa-check-all me-1"></i>Select All
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="clearAllColumnGroups()">
                          <i class="fas fa-times me-1"></i>Clear All
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">
                      Select which groups of patient data attributes to include in your analysis:
                    </p>

                    <!-- Column Groups Container -->
                    <div id="columnGroupsContent" style="display: none">
                      <div class="row" id="columnGroupsContainer">
                        <!-- Column groups will be dynamically populated here -->
                      </div>
                    </div>

                    <!-- Column Groups Summary -->
                    <div class="mt-3 p-3 bg-light rounded" id="columnGroupsSummary">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="selectionSummary">No attribute groups selected</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <span class="badge bg-primary" id="totalColumnsCount">0 total attributes</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Pre-Analysis Editor Tab -->
          <div class="tab-pane fade" id="preanalysis-editor" role="tabpanel">
            <!-- Attributes Discarding Policy -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-filter me-2"></i>
                        Attributes Discarding Policy
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleDiscardingPolicyBtn"
                          onclick="toggleDiscardingPolicy()">
                          <i class="fas fa-eye me-1"></i>Show Policies
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">
                      Configure policies for discarding patient attributes based on data quality criteria:
                    </p>

                    <!-- Discarding Policies Container -->
                    <div id="discardingPolicyContent" style="display: none">
                      <div class="row" id="discardingPolicyContainer">
                        <!-- Discarding policies will be dynamically populated here -->
                      </div>
                    </div>

                    <!-- Discarding Policy Summary -->
                    <div class="mt-3 p-3 bg-light rounded" id="discardingPolicySummary">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="discardingPolicySummaryText">No discarding policies configured</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <button
                            type="button"
                            class="btn btn-outline-success btn-sm me-2"
                            onclick="calculateRemainingAttributes()">
                            <i class="fas fa-calculator me-1"></i>Calculate Remaining
                          </button>
                          <span class="badge bg-primary" id="totalDiscardingPoliciesCount">0 policies</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Microbial Discarding Policy -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-bacteria me-2"></i>
                        Microbial Discarding Policy
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleMicrobialDiscardingPolicyBtn"
                          onclick="toggleMicrobialDiscardingPolicy()">
                          <i class="fas fa-eye me-1"></i>Show Policies
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">Configure policies for discarding microbial taxa based on abundance thresholds and prevalence criteria.</p>

                    <!-- Microbial Discarding Policies Container -->
                    <div id="microbialDiscardingPolicyContent" style="display: none">
                      <div class="row" id="microbialDiscardingPolicyContainer">
                        <!-- Microbial discarding policies will be dynamically populated here -->
                      </div>
                    </div>

                    <!-- Microbial Discarding Policy Summary -->
                    <div class="mt-3 p-3 bg-light rounded" id="microbialDiscardingPolicySummary">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="microbialDiscardingPolicySummaryText">No microbial discarding policies configured</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <button
                            type="button"
                            class="btn btn-outline-success btn-sm me-2"
                            onclick="calculateRemainingMicrobes()">
                            <i class="fas fa-calculator me-1"></i>Calculate Remaining
                          </button>
                          <span class="badge bg-primary" id="totalMicrobialDiscardingPoliciesCount">0 policies</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Microbial Grouping -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-object-group me-2"></i>
                        Microbial Grouping
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleMicrobialGroupingBtn"
                          onclick="toggleMicrobialGrouping()">
                          <i class="fas fa-eye me-1"></i>Show Options
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">Configure how microbial taxa should be grouped for analysis (e.g., by functional categories or custom groupings).</p>

                    <!-- Microbial Grouping Container -->
                    <div id="microbialGroupingContent" style="display: none">
                      <div class="row" id="microbialGroupingContainer">
                        <!-- Microbial grouping methods will be dynamically populated here -->
                      </div>
                    </div>

                    <!-- Microbial Grouping Summary -->
                    <div class="mt-3 p-3 bg-light rounded" id="microbialGroupingSummary">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="microbialGroupingSummaryText">No microbial grouping methods selected</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <span class="badge bg-primary" id="totalMicrobialGroupingMethodsCount">0 methods</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Clustering - Policy -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-project-diagram me-2"></i>
                        Clustering - Policy
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleClusteringBtn"
                          onclick="toggleClustering()">
                          <i class="fas fa-eye me-1"></i>Show Options
                        </button>
                        <button type="button" class="btn btn-outline-primary" onclick="resetClusteringToDefaults()">
                          <i class="fas fa-undo me-1"></i>Reset to Defaults
                        </button>
                        <button type="button" class="btn btn-outline-success" onclick="applyBestComponents()">
                          <i class="fas fa-magic me-1"></i>Apply Best Components
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">
                      Configure clustering methods and parameters for variable clustering analysis:
                    </p>

                    <!-- Clustering Method Selection -->
                    <div class="row mb-3">
                      <div class="col-md-6">
                        <label for="clusteringMethodSelect" class="form-label">
                          <i class="fas fa-cogs text-primary me-2"></i>
                          Clustering Method
                        </label>
                        <select class="form-select" id="clusteringMethodSelect" name="clusteringMethodSelect" onchange="updateClusteringParameters()">
                          <option value="">Select clustering method...</option>
                          <!-- Options will be populated dynamically -->
                        </select>
                        <div class="form-text" id="clusteringMethodDescription">
                          Choose a clustering algorithm for variable grouping
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Method Status</label>
                        <div class="d-flex align-items-center">
                          <span class="badge bg-secondary me-2" id="clusteringMethodStatus">No method selected</span>
                          <button type="button" class="btn btn-outline-info btn-sm" onclick="showClusteringInfo()">
                            <i class="fas fa-info-circle me-1"></i>Info
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Clustering Parameters Container -->
                    <div id="clusteringParametersContainer" style="display: none">
                      <div class="row">
                        <div class="col-12">
                          <h6 class="mb-3">
                            <i class="fas fa-sliders-h me-2"></i>
                            Method Parameters
                          </h6>
                          <div id="clusteringParametersForm">
                            <!-- Parameters will be dynamically populated here -->
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Clustering Summary -->
                    <div class="mt-3 p-3 bg-light rounded" id="clusteringSummary" style="display: none">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="clusteringSummaryText">No clustering method configured</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <span class="badge bg-primary" id="clusteringParametersCount">0 parameters</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Clustering - Naming -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-users me-2"></i>
                        Clustering - Naming
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleClusterRepBtn"
                          onclick="toggleClusterRepresentative()">
                          <i class="fas fa-eye me-1"></i>Show Options
                        </button>
                        <button
                          type="button"
                          class="btn btn-outline-primary"
                          onclick="resetClusterRepresentativeToDefault()">
                          <i class="fas fa-undo me-1"></i>Reset to Default
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <label class="form-label">Representative Method</label>
                        <select
                          class="form-select"
                          id="clusterRepresentativeMethod"
                          name="clusterRepresentativeMethod"
                          onchange="updateClusterRepresentativeMethod()">
                          <option value="">Select a method...</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Method Status</label>
                        <div class="d-flex align-items-center">
                          <span class="badge bg-secondary me-2" id="clusterRepMethodStatus">No method selected</span>
                          <button
                            type="button"
                            class="btn btn-outline-info btn-sm"
                            onclick="showClusterRepresentativeInfo()">
                            <i class="fas fa-info-circle me-1"></i>Info
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Cluster Representative Container -->
                    <div id="clusterRepresentativeContainer" style="display: none">
                      <div class="row mt-3">
                        <div class="col-12">
                          <h6 class="mb-3">
                            <i class="fas fa-cog me-2"></i>
                            Method Details
                          </h6>
                          <div id="clusterRepresentativeDetails">
                            <!-- Method details will be dynamically populated here -->
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Cluster Representative Summary -->
                    <div class="mt-3 p-3 bg-light rounded" id="clusterRepSummary" style="display: none">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="clusterRepSummaryText">No representative method configured</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <span class="badge bg-primary" id="clusterRepMethodName">No method</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Analysis Editor Tab -->
          <div class="tab-pane fade" id="analysis-editor" role="tabpanel">
            <!-- Analysis Type Selection -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h6 class="mb-0">
                      <i class="fas fa-flask me-2"></i>
                      Analysis Type
                    </h6>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">Select the analysis method and configure its parameters:</p>

                    <!-- Analysis Method Selection -->
                    <div class="row mb-4">
                      <div class="col-md-6">
                        <label for="analysisMethodSelect" class="form-label">
                          <i class="fas fa-cogs text-primary me-2"></i>
                          Analysis Method
                        </label>
                        <select class="form-select" id="analysisMethodSelect" name="analysisMethodSelect">
                          <option value="">Select analysis method...</option>
                          <!-- Options will be populated dynamically -->
                        </select>
                        <div class="form-text" id="analysisMethodDescription">
                          Choose a method for multivariate survival analysis
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Method Status</label>
                        <div class="d-flex align-items-center">
                          <span class="badge bg-secondary me-2" id="analysisMethodStatus">No method selected</span>
                          <button type="button" class="btn btn-outline-info btn-sm" onclick="showAnalysisMethodInfo()">
                            <i class="fas fa-info-circle me-1"></i>Info
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Analysis Method Parameters Containers (one per method, hidden by default) -->
                    <div id="analysisMethodParametersContainers">
                      <!-- These containers will be filled by JS at load time, one per method, each with id="analysisMethodParameters_{methodKey}" -->
                    </div>

                    <!-- Analysis Method Summary -->
                    <div class="mt-3 p-3 bg-light rounded" id="analysisMethodSummary" style="display: none">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="analysisMethodSummaryText">No analysis method configured</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <span class="badge bg-primary" id="analysisMethodParametersCount">0 parameters</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Post-Analysis Editor Tab -->
          <div class="tab-pane fade" id="postanalysis-editor" role="tabpanel">
            <!-- Population Sectors Comparison -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-layer-group me-2"></i>
                        Population Sectors Comparison
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleStratificationBtn"
                          onclick="toggleStratification()">
                          <i class="fas fa-eye me-1"></i>Show Options
                        </button>
                        <button type="button" class="btn btn-outline-primary" onclick="selectAllStratifications()">
                          <i class="fas fa-check-all me-1"></i>Select All
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="clearAllStratifications()">
                          <i class="fas fa-times me-1"></i>Clear All
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">
                      Select stratification methods to divide the population into subgroups for comparative analysis:
                    </p>
                    <div id="stratificationContainer" style="display: none">
                      <!-- Stratification options will be dynamically populated here -->
                    </div>

                    <!-- Stratification Summary -->
                    <div class="mt-3 p-3 bg-light rounded" id="stratificationSummary">
                      <div class="row align-items-center">
                        <div class="col-md-8">
                          <div class="d-flex align-items-center">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="stratificationSummaryText">No stratifications selected</span>
                          </div>
                        </div>
                        <div class="col-md-4 text-end">
                          <span class="badge bg-primary" id="stratificationCount">0 stratifications</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sample Timepoints Comparison -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-timeline me-2"></i>
                        Sample Timepoints Comparison
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleSampleTimepointsBtn"
                          onclick="toggleSampleTimepoints()">
                          <i class="fas fa-eye me-1"></i>Show Options
                        </button>
                        <button type="button" class="btn btn-outline-primary" onclick="selectAllSampleTimepoints()">
                          <i class="fas fa-check-all me-1"></i>Select All
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="clearAllSampleTimepoints()">
                          <i class="fas fa-times me-1"></i>Clear All
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">Configure comparison of analysis results across different sample timepoints.</p>
                    <!-- Sample Timepoints Comparison content -->
                    <div id="sampleTimepointsCard">
                      <div class="row mb-2">
                        <div class="col-md-4 d-flex align-items-center">
                          <div class="w-100">
                            <span class="form-text">Timepoint selected in Data Source: <strong id="selectedTimePointDisplay">None</strong></span>
                          </div>
                        </div>
                        <div class="col-md-8 text-end align-self-end">
                          <!-- header buttons shown above; keep this space for possible future controls -->
                        </div>
                      </div>

                      <div id="sampleTimepointsContainer" style="display: none; grid-template-columns: repeat(2, 1fr); gap: .5rem;">
                        <!-- checkboxes for other timepoints will be rendered here -->
                      </div>

                      <div class="mt-3 p-2 bg-light rounded" id="sampleTimepointsSummary">
                        <div class="d-flex align-items-center justify-content-between">
                          <div>
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="sampleTimepointsSummaryText">No timepoints selected</span>
                          </div>
                          <div>
                            <span class="badge bg-primary" id="sampleTimepointsCount">0 selected</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Microbial Grouping Comparison removed -->

            <!-- Analysis Methods Comparison -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h6 class="mb-0">
                        <i class="fas fa-balance-scale me-2"></i>
                        Analysis Methods Comparison
                      </h6>
                      <div class="btn-group btn-group-sm">
                        <button
                          type="button"
                          class="btn btn-outline-secondary"
                          id="toggleAnalysisMethodsBtn"
                          onclick="toggleAnalysisMethods()">
                          <i class="fas fa-eye me-1"></i>Show Options
                        </button>
                        <button type="button" class="btn btn-outline-primary" onclick="selectAllAnalysisMethods()">
                          <i class="fas fa-check-all me-1"></i>Select All
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="clearAllAnalysisMethods()">
                          <i class="fas fa-times me-1"></i>Clear All
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <p class="text-muted mb-3">Configure comparison of results produced by different analysis methods.</p>

                    <div id="analysisMethodsCard">
                      <div class="row mb-2">
                        <div class="col-12 d-flex align-items-center">
                          <div class="w-100">
                            <span class="form-text">MVA Method selected in Analysis: <strong id="selectedAnalysisMethodDisplay">None</strong></span>
                          </div>
                        </div>
                        <div class="col-12 text-end align-self-end">
                          <!-- header buttons shown above; reserved space -->
                        </div>
                      </div>
                      <div id="analysisMethodsContainer" style="display: none; grid-template-columns: repeat(2, 1fr); gap: .5rem;">
                        <!-- analysis method cards will be rendered here -->
                      </div>

                      <div class="mt-3 p-2 bg-light rounded" id="analysisMethodsSummary">
                        <div class="d-flex align-items-center justify-content-between">
                          <div>
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            <span id="analysisMethodsSummaryText">No methods selected</span>
                          </div>
                          <div>
                            <span class="badge bg-primary" id="analysisMethodsCount">0 selected</span>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Output Options Editor Tab -->
          <div class="tab-pane fade" id="output-editor" role="tabpanel">
            <div class="row">
              <div class="col-md-6">
                <h6 class="mb-3">
                  <i class="fas fa-file-pdf me-2"></i>
                  Report Format
                </h6>
                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="reportPDF" name="reportPDF" checked />
                    <label class="form-check-label" for="reportPDF"> PDF Report </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="reportHTML" name="reportHTML" />
                    <label class="form-check-label" for="reportHTML"> HTML Report </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="reportCSV" name="reportCSV" />
                    <label class="form-check-label" for="reportCSV"> CSV Data Export </label>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <h6 class="mb-3">
                  <i class="fas fa-chart-pie me-2"></i>
                  Report Contents
                </h6>
                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="includeSummary" name="includeSummary" checked />
                    <label class="form-check-label" for="includeSummary"> Summary Statistics </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="includePlots" name="includePlots" checked />
                    <label class="form-check-label" for="includePlots"> Visualization Plots </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="includeRawData" name="includeRawData" />
                    <label class="form-check-label" for="includeRawData"> Raw Data Tables </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Editor Action Buttons -->
        <div class="border-top pt-3 mt-3">
          <div class="d-flex justify-content-end">
            <div class="btn-group">
              <button type="button" class="btn btn-outline-secondary" onclick="cancelAnalysisEdit()">
                <i class="fas fa-times me-1"></i>Close
              </button>
              <button type="button" class="btn btn-success" onclick="saveAnalysis()">
                <i class="fas fa-save me-1"></i>Save
              </button>
              <button type="button" class="btn btn-primary" onclick="runAnalysisFromEditor()">
                <i class="fas fa-play me-1"></i>Run Analysis
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
