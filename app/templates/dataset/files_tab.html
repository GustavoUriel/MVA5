{% extends "dataset/base.html" %}

{% block tab_content %}
<!-- Upload Progress -->
{% include 'dataset/partials/progress_indicator.html' with context %}

<!-- Upload Interface -->
<div class="row mb-4">
    <!-- Patients Data Upload -->
    <div class="col-md-4">
        <div class="card h-100" id="patients-upload-card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-user-injured me-2 text-primary"></i>
                    Patients Data
                </h6>
            </div>
            <div class="card-body" id="patients-upload-body">
                <div class="upload-section" data-file-type="patients">
                    <!-- File Upload -->
                    <div class="mb-3">
                        <label class="form-label">Upload File</label>
                        <input type="file" class="form-control" accept=".csv,.tsv,.txt" 
                               name="file" data-file-type="patients" data-upload-method="file">
                        <div class="form-text">Supported formats: CSV, TSV, TXT</div>
                    </div>
                    
                    <button type="button" class="btn btn-primary w-100 upload-btn" 
                            data-file-type="patients">
                        <i class="fas fa-upload me-2"></i>
                        Upload Patients Data
                    </button>
                    
                    <!-- Status/Results Box -->
                    <div class="mt-3" id="patients-status-container">
                        <div class="alert alert-light border" role="alert" id="patients-status" style="padding: 0.75rem 1rem;">
                            {% if dataset.patients_file_uploaded %}
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <strong>File uploaded successfully</strong>
                            {% else %}
                                <i class="fas fa-info-circle text-muted me-2"></i>
                                <span class="text-muted">No actions yet</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Taxonomy Data Upload -->
    <div class="col-md-4">
        <div class="card h-100" id="taxonomy-upload-card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-sitemap me-2 text-info"></i>
                    Taxonomy Data
                </h6>
            </div>
            <div class="card-body" id="taxonomy-upload-body">
                <div class="upload-section" data-file-type="taxonomy">
                    <!-- File Upload -->
                    <div class="mb-3">
                        <label class="form-label">Upload File</label>
                        <input type="file" class="form-control" accept=".csv,.tsv,.txt" 
                               name="file" data-file-type="taxonomy" data-upload-method="file">
                        <div class="form-text">Supported formats: CSV, TSV, TXT</div>
                    </div>
                    
                    <button type="button" class="btn btn-info w-100 upload-btn" 
                            data-file-type="taxonomy">
                        <i class="fas fa-upload me-2"></i>
                        Upload Taxonomy Data
                    </button>
                    
                    <!-- Status/Results Box -->
                    <div class="mt-3" id="taxonomy-status-container">
                        <div class="alert alert-light border" role="alert" id="taxonomy-status" style="padding: 0.75rem 1rem;">
                            {% if dataset.taxonomy_file_uploaded %}
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <strong>File uploaded successfully</strong>
                            {% else %}
                                <i class="fas fa-info-circle text-muted me-2"></i>
                                <span class="text-muted">No actions yet</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bracken Results Upload -->
    <div class="col-md-4">
        <div class="card h-100" id="bracken-upload-card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-chart-bar me-2 text-success"></i>
                    Bracken Results
                </h6>
            </div>
            <div class="card-body" id="bracken-upload-body">
                <div class="upload-section" data-file-type="bracken">
                    <!-- File Upload -->
                    <div class="mb-3">
                        <label class="form-label">Upload File</label>
                        <input type="file" class="form-control" accept=".csv,.tsv,.txt" 
                               name="file" data-file-type="bracken" data-upload-method="file">
                        <div class="form-text">Supported formats: CSV, TSV, TXT</div>
                    </div>
                    
                    <button type="button" class="btn btn-success w-100 upload-btn" 
                            data-file-type="bracken">
                        <i class="fas fa-upload me-2"></i>
                        Upload Bracken Results
                    </button>
                    
                    <!-- Status/Results Box -->
                    <div class="mt-3" id="bracken-status-container">
                        <div class="alert alert-light border" role="alert" id="bracken-status" style="padding: 0.75rem 1rem;">
                            {% if dataset.bracken_file_uploaded %}
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <strong>File uploaded successfully</strong>
                            {% else %}
                                <i class="fas fa-info-circle text-muted me-2"></i>
                                <span class="text-muted">No actions yet</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Data Statistics and Sanitization Section -->
<div class="card mb-4">
    <div class="card-header">
        <h6 class="mb-0">
            <i class="fas fa-chart-bar me-2 text-info"></i>
            Data Statistics & Sanitization
        </h6>
    </div>
    <div class="card-body">
        <div id="dataStatsSection">
            <div class="text-center py-4">
                <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                <p class="mt-2 text-muted">Analyzing data...</p>
            </div>
        </div>
    </div>
</div>

<!-- Uploaded Files Table -->
<div class="card">
    <div class="card-header">
        <h6 class="mb-0">
            <i class="fas fa-folder me-2"></i>
            Uploaded Files
        </h6>
    </div>
    <div class="card-body">
        <div id="filesTable">
            <div class="text-center py-4">
                <i class="fas fa-spinner fa-spin fa-2x text-muted"></i>
                <p class="mt-2 text-muted">Loading files...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
