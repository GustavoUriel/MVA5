{% extends "dataset/base.html" %}

{% block tab_content %}
<!-- Analysis List Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
                <h5 class="mb-1">
                    <i class="fas fa-chart-line me-2 text-primary"></i>
                    Analysis Management
                </h5>
                <p class="text-muted mb-0">Create, manage, and run microbiome analyses</p>
            </div>
            <button type="button" class="btn btn-primary" onclick="createNewAnalysis()">
                <i class="fas fa-plus me-1"></i>New Analysis
            </button>
        </div>
        
        <!-- Analysis List -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex align-items-center justify-content-between">
                    <h6 class="mb-0">
                        <i class="fas fa-list me-2"></i>
                        Existing Analyses
                    </h6>
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-outline-secondary" onclick="refreshAnalysisList()">
                            <i class="fas fa-sync-alt me-1"></i>Refresh
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="analysisListContainer">
                    <!-- Analysis list will be populated here -->
                    <div class="text-center py-4" id="noAnalysesState">
                        <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted mb-2">No Analyses Created Yet</h6>
                        <p class="text-muted mb-3">Create your first analysis to get started with microbiome data exploration.</p>
                        <button type="button" class="btn btn-primary" onclick="createNewAnalysis()">
                            <i class="fas fa-plus me-1"></i>Create First Analysis
                        </button>
                    </div>
                    
                    <!-- Analysis Table (hidden by default) -->
                    <div id="analysisTable" style="display: none;">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Created</th>
                                        <th>Modified</th>
                                        <th>Size</th>
                                        <th>Last Run</th>
                                        <th>Patients</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="analysisTableBody">
                                    <!-- Analysis rows will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Analysis Editor Section -->
<div class="row" id="analysisEditorSection" style="display: none;">
    <div class="col-12">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
                <div class="d-flex align-items-center justify-content-between">
                    <h6 class="mb-0">
                        <i class="fas fa-edit me-2"></i>
                        <span id="editorTitle">Analysis Configuration</span>
                    </h6>
                    <div class="btn-group">
                        <button type="button" class="btn btn-light btn-sm" onclick="saveAnalysis()">
                            <i class="fas fa-save me-1"></i>Save
                        </button>
                        <button type="button" class="btn btn-outline-light btn-sm" onclick="cancelAnalysisEdit()">
                            <i class="fas fa-times me-1"></i>Cancel
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!-- Analysis Information Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Analysis Information
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="analysisName" class="form-label">Analysis Name</label>
                                        <input type="text" class="form-control" id="analysisName" placeholder="Enter analysis name...">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="analysisDescription" class="form-label">Description</label>
                                        <input type="text" class="form-control" id="analysisDescription" placeholder="Brief description...">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Editor Tabs -->
                <ul class="nav nav-tabs" id="analysisEditorTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="datasources-editor-tab" data-bs-toggle="tab" data-bs-target="#datasources-editor" type="button" role="tab">
                            <i class="fas fa-layer-group me-2"></i>Data Sources
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="config-editor-tab" data-bs-toggle="tab" data-bs-target="#config-editor" type="button" role="tab">
                            <i class="fas fa-sliders-h me-2"></i>Analysis Config
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reports-config-tab" data-bs-toggle="tab" data-bs-target="#reports-config" type="button" role="tab">
                            <i class="fas fa-file-alt me-2"></i>Report Config
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content mt-3" id="analysisEditorTabsContent">
                    <!-- Data Sources Editor Tab -->
                    <div class="tab-pane fade show active" id="datasources-editor" role="tabpanel">
                        <!-- File Selection Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="fas fa-files me-2"></i>
                                            Select Data Files
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <!-- Patient File Selection -->
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="editorPatientFileSelect" class="form-label">
                                                        <i class="fas fa-user-injured text-primary me-2"></i>
                                                        Patient Data File
                                                    </label>
                                                    <select class="form-select" id="editorPatientFileSelect" onchange="validateAnalysisEditor()">
                                                        <option value="">Select patient file...</option>
                                                        <!-- Options will be populated dynamically -->
                                                    </select>
                                                    <div class="form-text">Choose the patient metadata file for analysis</div>
                                                </div>
                                            </div>

                                            <!-- Taxonomy File Selection -->
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="editorTaxonomyFileSelect" class="form-label">
                                                        <i class="fas fa-sitemap text-info me-2"></i>
                                                        Taxonomy Data File
                                                    </label>
                                                    <select class="form-select" id="editorTaxonomyFileSelect" onchange="validateAnalysisEditor()">
                                                        <option value="">Select taxonomy file...</option>
                                                        <!-- Options will be populated dynamically -->
                                                    </select>
                                                    <div class="form-text">Choose the taxonomy reference file</div>
                                                </div>
                                            </div>

                                            <!-- Bracken File Selection -->
                                            <div class="col-md-4">
                                                <div class="mb-3">
                                                    <label for="editorBrackenFileSelect" class="form-label">
                                                        <i class="fas fa-chart-bar text-success me-2"></i>
                                                        Bracken Results File
                                                    </label>
                                                    <select class="form-select" id="editorBrackenFileSelect" onchange="validateAnalysisEditor()">
                                                        <option value="">Select bracken file...</option>
                                                        <!-- Options will be populated dynamically -->
                                                    </select>
                                                    <div class="form-text">Choose the bracken abundance data file</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Extreme Time Point Selection -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="fas fa-chart-line me-2"></i>
                                            Extreme Time Point Selection
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <!-- Selection Mode Toggle -->
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="selectionModeToggle" 
                                                           onchange="toggleSelectionMode()">
                                                    <label class="form-check-label" for="selectionModeToggle">
                                                        <i class="fas fa-toggle-on me-2"></i>
                                                        <span id="selectionModeLabel">Select by percentage of patients</span>
                                                    </label>
                                                </div>
                                                <div class="form-text" id="selectionModeDescription">
                                                    When enabled: Select by percentage of time variable value range. When disabled: Select by percentage of patients.
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="topPercentage" class="form-label">
                                                        <i class="fas fa-arrow-up text-success me-2"></i>
                                                        <span id="topPercentageLabel">Top Percentage</span>
                                                    </label>
                                                    <div class="input-group">
                                                        <input type="range" class="form-range" id="topPercentage" 
                                                               min="10" max="50" value="25" step="5" 
                                                               oninput="updateTopPercentage(this.value)">
                                                        <span class="input-group-text" id="topPercentageValue">25%</span>
                                                    </div>
                                                    <div class="form-text" id="topPercentageDescription">Percentage of patients with highest time values</div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="bottomPercentage" class="form-label">
                                                        <i class="fas fa-arrow-down text-danger me-2"></i>
                                                        <span id="bottomPercentageLabel">Bottom Percentage</span>
                                                    </label>
                                                    <div class="input-group">
                                                        <input type="range" class="form-range" id="bottomPercentage" 
                                                               min="10" max="50" value="25" step="5" 
                                                               oninput="updateBottomPercentage(this.value)">
                                                        <span class="input-group-text" id="bottomPercentageValue">25%</span>
                                                    </div>
                                                    <div class="form-text" id="bottomPercentageDescription">Percentage of patients with lowest time values</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="linkPercentages" 
                                                           checked onchange="toggleLinkedPercentages()">
                                                    <label class="form-check-label" for="linkPercentages">
                                                        <i class="fas fa-link me-2"></i>
                                                        Link top and bottom percentages to the same value
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Extreme Time Point Summary -->
                                        <div class="mt-3 p-3 bg-light rounded">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                                        <span id="extremeTimePointSummaryText">Select data files to see patient counts</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <span class="badge bg-success me-2" id="topPatientsCount">0 patients</span>
                                                    <span class="badge bg-danger me-2" id="bottomPatientsCount">0 patients</span>
                                                    <span class="badge bg-primary" id="totalPatientsCount">0 total</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Column Groups Selection Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <h6 class="mb-0">
                                                <i class="fas fa-layer-group me-2"></i>
                                                Patient Data Column Groups
                                            </h6>
                                            <div class="btn-group btn-group-sm">
                                                <button type="button" class="btn btn-outline-secondary" id="toggleColumnGroupsBtn" onclick="toggleColumnGroups()">
                                                    <i class="fas fa-eye me-1"></i>Show Column Groups
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary" id="toggleFieldNamesBtn" onclick="toggleFieldNames()">
                                                    <i class="fas fa-eye me-1"></i>Show Field Names
                                                </button>
                                                <button type="button" class="btn btn-outline-primary" onclick="selectAllColumnGroups()">
                                                    <i class="fas fa-check-all me-1"></i>Select All
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary" onclick="clearAllColumnGroups()">
                                                    <i class="fas fa-times me-1"></i>Clear All
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">Select which groups of patient data columns to include in your analysis:</p>
                                        
                                        <!-- Column Groups Container -->
                                        <div id="columnGroupsContent" style="display: none;">
                                            <div class="row" id="columnGroupsContainer">
                                                <!-- Column groups will be dynamically populated here -->
                                            </div>
                                        </div>
                                        
                                        <!-- Column Groups Summary -->
                                        <div class="mt-3 p-3 bg-light rounded" id="columnGroupsSummary">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                                        <span id="selectionSummary">No column groups selected</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <span class="badge bg-primary" id="totalColumnsCount">0 total columns</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bracken Time Point Selection -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <h6 class="mb-0">
                                                <i class="fas fa-timeline text-warning me-2"></i>
                                                Bracken Time Point Selection
                                            </h6>
                                            <div class="btn-group btn-group-sm">
                                                <button type="button" class="btn btn-outline-info" onclick="showBrackenTimePointInfo()">
                                                    <i class="fas fa-info-circle me-1"></i>Info
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">Select the time point for Bracken abundance analysis:</p>
                                        
                                        <!-- Time Point Selection -->
                                        <div class="row">
                                            <div class="col-12">
                                                <label for="editorBrackenTimePointSelect" class="form-label">
                                                    <i class="fas fa-timeline text-warning me-2"></i>
                                                    Bracken Time Point
                                                </label>
                                                <select class="form-select" id="editorBrackenTimePointSelect" onchange="updateTimePointDescription()">
                                                    <option value="">Choose time point...</option>
                                                    <!-- Options will be populated dynamically -->
                                                </select>
                                                <div class="form-text" id="timePointDescription">Select a time point to see its description</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Population Stratification Selection -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <h6 class="mb-0">
                                                <i class="fas fa-layer-group me-2"></i>
                                                Population Stratification
                                            </h6>
                                            <div class="btn-group btn-group-sm">
                                                <button type="button" class="btn btn-outline-secondary" id="toggleStratificationBtn" onclick="toggleStratification()">
                                                    <i class="fas fa-eye me-1"></i>Show Stratification Options
                                                </button>
                                                <button type="button" class="btn btn-outline-primary" onclick="selectAllStratifications()">
                                                    <i class="fas fa-check-all me-1"></i>Select All
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary" onclick="clearAllStratifications()">
                                                    <i class="fas fa-times me-1"></i>Clear All
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">Select stratification methods to divide the population into subgroups for comparative analysis:</p>
                                        <div id="stratificationContainer" style="display: none;">
                                            <!-- Stratification options will be dynamically populated here -->
                                        </div>
                                        
                                        <!-- Stratification Summary -->
                                        <div class="mt-3 p-3 bg-light rounded" id="stratificationSummary">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                                        <span id="stratificationSummaryText">No stratifications selected</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <span class="badge bg-primary" id="stratificationCount">0 stratifications</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    
                    <!-- Analysis Config Editor Tab -->
                    <div class="tab-pane fade" id="config-editor" role="tabpanel">
                        
                        
                        <!-- Clustering Parameters Selection -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <h6 class="mb-0">
                                                <i class="fas fa-project-diagram me-2"></i>
                                                Clustering Parameters
                                            </h6>
                                            <div class="btn-group btn-group-sm">
                                                <button type="button" class="btn btn-outline-secondary" id="toggleClusteringBtn" onclick="toggleClustering()">
                                                    <i class="fas fa-eye me-1"></i>Show Clustering Options
                                                </button>
                                                <button type="button" class="btn btn-outline-primary" onclick="resetClusteringToDefaults()">
                                                    <i class="fas fa-undo me-1"></i>Reset to Defaults
                                                </button>
                                                <button type="button" class="btn btn-outline-success" onclick="applyBestComponents()">
                                                    <i class="fas fa-magic me-1"></i>Apply Best Components
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">Configure clustering methods and parameters for variable clustering analysis:</p>
                                        
                                        <!-- Clustering Method Selection -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="clusteringMethodSelect" class="form-label">
                                                    <i class="fas fa-cogs text-primary me-2"></i>
                                                    Clustering Method
                                                </label>
                                                <select class="form-select" id="clusteringMethodSelect" onchange="updateClusteringParameters()">
                                                    <option value="">Select clustering method...</option>
                                                    <!-- Options will be populated dynamically -->
                                                </select>
                                                <div class="form-text" id="clusteringMethodDescription">Choose a clustering algorithm for variable grouping</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Method Status</label>
                                                <div class="d-flex align-items-center">
                                                    <span class="badge bg-secondary me-2" id="clusteringMethodStatus">No method selected</span>
                                                    <button type="button" class="btn btn-outline-info btn-sm" onclick="showClusteringInfo()">
                                                        <i class="fas fa-info-circle me-1"></i>Info
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Clustering Parameters Container -->
                                        <div id="clusteringParametersContainer" style="display: none;">
                                            <div class="row">
                                                <div class="col-12">
                                                    <h6 class="mb-3">
                                                        <i class="fas fa-sliders-h me-2"></i>
                                                        Method Parameters
                                                    </h6>
                                                    <div id="clusteringParametersForm">
                                                        <!-- Parameters will be dynamically populated here -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Clustering Summary -->
                                        <div class="mt-3 p-3 bg-light rounded" id="clusteringSummary" style="display: none;">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                                        <span id="clusteringSummaryText">No clustering method configured</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <span class="badge bg-primary" id="clusteringParametersCount">0 parameters</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cluster Representative Selection -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <h6 class="mb-0">
                                                <i class="fas fa-users me-2"></i>
                                                Cluster Representative Selection
                                            </h6>
                                            <div class="btn-group btn-group-sm">
                                                <button type="button" class="btn btn-outline-secondary" id="toggleClusterRepBtn" onclick="toggleClusterRepresentative()">
                                                    <i class="fas fa-eye me-1"></i>Show Options
                                                </button>
                                                <button type="button" class="btn btn-outline-primary" onclick="resetClusterRepresentativeToDefault()">
                                                    <i class="fas fa-undo me-1"></i>Reset to Default
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">Representative Method</label>
                                                <select class="form-select" id="clusterRepresentativeMethod" onchange="updateClusterRepresentativeMethod()">
                                                    <option value="">Select a method...</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Method Status</label>
                                                <div class="d-flex align-items-center">
                                                    <span class="badge bg-secondary me-2" id="clusterRepMethodStatus">No method selected</span>
                                                    <button type="button" class="btn btn-outline-info btn-sm" onclick="showClusterRepresentativeInfo()">
                                                        <i class="fas fa-info-circle me-1"></i>Info
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Cluster Representative Container -->
                                        <div id="clusterRepresentativeContainer" style="display: none;">
                                            <div class="row mt-3">
                                                <div class="col-12">
                                                    <h6 class="mb-3">
                                                        <i class="fas fa-cog me-2"></i>
                                                        Method Details
                                                    </h6>
                                                    <div id="clusterRepresentativeDetails">
                                                        <!-- Method details will be dynamically populated here -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Cluster Representative Summary -->
                                        <div class="mt-3 p-3 bg-light rounded" id="clusterRepSummary" style="display: none;">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                                        <span id="clusterRepSummaryText">No representative method configured</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <span class="badge bg-primary" id="clusterRepMethodName">No method</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Analysis Type Selection -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="fas fa-flask me-2"></i>
                                            Analysis Type
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">Select the analysis method and configure its parameters:</p>
                                        
                                        <!-- Analysis Method Selection -->
                                        <div class="row mb-4">
                                            <div class="col-md-6">
                                                <label for="analysisMethodSelect" class="form-label">
                                                    <i class="fas fa-cogs text-primary me-2"></i>
                                                    Analysis Method
                                                </label>
                                                <select class="form-select" id="analysisMethodSelect" onchange="updateAnalysisMethod()">
                                                    <option value="">Select analysis method...</option>
                                                    <!-- Options will be populated dynamically -->
                                                </select>
                                                <div class="form-text" id="analysisMethodDescription">Choose a method for multivariate survival analysis</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Method Status</label>
                                                <div class="d-flex align-items-center">
                                                    <span class="badge bg-secondary me-2" id="analysisMethodStatus">No method selected</span>
                                                    <button type="button" class="btn btn-outline-info btn-sm" onclick="showAnalysisMethodInfo()">
                                                        <i class="fas fa-info-circle me-1"></i>Info
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Analysis Method Parameters Container -->
                                        <div id="analysisMethodParametersContainer" style="display: none;">
                                            <div class="row">
                                                <div class="col-12">
                                                    <h6 class="mb-3">
                                                        <i class="fas fa-sliders-h me-2"></i>
                                                        Method Parameters
                                                    </h6>
                                                    <div id="analysisMethodParametersForm">
                                                        <!-- Parameters will be dynamically populated here -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Analysis Method Summary -->
                                        <div class="mt-3 p-3 bg-light rounded" id="analysisMethodSummary" style="display: none;">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-info-circle text-primary me-2"></i>
                                                        <span id="analysisMethodSummaryText">No analysis method configured</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <span class="badge bg-primary" id="analysisMethodParametersCount">0 parameters</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reports Config Editor Tab -->
                    <div class="tab-pane fade" id="reports-config" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="mb-3">
                                    <i class="fas fa-file-pdf me-2"></i>
                                    Report Format
                                </h6>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="reportPDF" checked>
                                        <label class="form-check-label" for="reportPDF">
                                            PDF Report
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="reportHTML">
                                        <label class="form-check-label" for="reportHTML">
                                            HTML Report
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="reportCSV">
                                        <label class="form-check-label" for="reportCSV">
                                            CSV Data Export
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="mb-3">
                                    <i class="fas fa-chart-pie me-2"></i>
                                    Report Content
                                </h6>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="includeSummary" checked>
                                        <label class="form-check-label" for="includeSummary">
                                            Summary Statistics
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="includePlots" checked>
                                        <label class="form-check-label" for="includePlots">
                                            Visualization Plots
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="includeRawData">
                                        <label class="form-check-label" for="includeRawData">
                                            Raw Data Tables
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Editor Action Buttons -->
                <div class="border-top pt-3 mt-3">
                    <div class="d-flex justify-content-end">
                        <div class="btn-group">
                            <button type="button" class="btn btn-outline-secondary" onclick="cancelAnalysisEdit()">
                                <i class="fas fa-times me-1"></i>Cancel
                            </button>
                            <button type="button" class="btn btn-success" onclick="saveAnalysis()">
                                <i class="fas fa-save me-1"></i>Save
                            </button>
                            <button type="button" class="btn btn-primary" onclick="runAnalysisFromEditor()">
                                <i class="fas fa-play me-1"></i>Run Analysis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
